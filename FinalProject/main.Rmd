---
title: "modeling"
author: "Stanley Zheng"
date: "2025-04-15"
output: html_document
---

```{r}
example_data = read.csv("data/example_data_2003-04.csv", header = TRUE, stringsAsFactors = FALSE)
mydf_2005_2009 <- read.csv("data/5y/2005-2009_NBA_data.csv", header = TRUE, stringsAsFactors = FALSE)
mydf_2010_2014 <- read.csv("data/5y/2010-2014_NBA_data.csv", header = TRUE, stringsAsFactors = FALSE)
mydf_2015_2019 <- read.csv("data/5y/2015-2019_NBA_data.csv", header = TRUE, stringsAsFactors = FALSE)
mydf_2020_2024 <- read.csv("data/5y/2020-2024_NBA_data.csv", header = TRUE, stringsAsFactors = FALSE)
```

```{r}
head(mydf_2005_2009)
```
```{r}
jpeg("img/3P shooting percent.jpg", width = 3000, height = 1500, res = 300)
par(mfrow = c(1, 2), mar = c(5, 4, 7, 2))

hist(mydf_2005_2009$X3P.,
     main = "3 Point Shooting Percent in 2005-2009",
     xlab = "3P%",
     ylab = "Frequency",
     col = "lightblue",
     border = "black")

hist(mydf_2020_2024$X3P.,
     main = "3 Point Ahooting Percent in 2020-2024",
     xlab = "3P%",
     ylab = "Frequency",
     col = "lightblue",
     border = "black")

dev.off()
```
```{r}
jpeg("img/3 point attempt rate.jpg", width = 3000, height = 1500, res = 300)
par(mfrow = c(1, 2))

hist(mydf_2005_2009$X3P_ratio,
     main = "3 point attempt rate in 2005-2009",
     xlab = "3P_ratio",
     ylab = "Frequency",
     col = "lightblue",
     border = "black")

hist(mydf_2020_2024$X3P_ratio,
     main = "3 point attempt rate in 2020-2024",
     xlab = "3P_ratio",
     ylab = "Frequency",
     col = "lightblue",
     border = "black")

dev.off()
```


```{r}
model_2005_2009 <- lm(WinRate ~ X3P. + X2P. + X3P_ratio, data = mydf_2005_2009)
summary(model_2005_2009)
model_2020_2024 <- lm(WinRate ~ X3P. + X2P. + X3P_ratio, data = mydf_2020_2024)
summary(model_2020_2024)
```

```{r}
model_2010_2014 <- lm(WinRate ~ X3P. + X2P. + X3P_ratio, data = mydf_2010_2014)
summary(model_2010_2014)
model_2015_2019 <- lm(WinRate ~ X3P. + X2P. + X3P_ratio, data = mydf_2015_2019)
summary(model_2015_2019)
```
```{r}
head(mydf_2005_2009)
```


```{r}
mydf_2005_2009_confounder <- mydf_2005_2009[, !(names(mydf_2005_2009) %in% c("X", "TEAM_ID", "TEAM_NAME", "FG_PCT", "X2P_ratio"))]
model_2015_2019_confounder0 <- lm(WinRate ~ ., data = mydf_2005_2009_confounder)
summary(model_2015_2019_confounder0)
```
```{r}
mydf_2005_2009_confounder <- mydf_2005_2009[, !(names(mydf_2005_2009) %in% c("X", "TEAM_ID", "TEAM_NAME", "FG_PCT", "X2P_ratio", "PTS", "PLUS_MINUS"))]
model_2015_2019_confounder0 <- lm(WinRate ~ ., data = mydf_2005_2009_confounder)
summary(model_2015_2019_confounder0)
```
```{r}
library(ggplot2)
library(tidyr)

# 先把你的数据建出来
df <- data.frame(
  Period = c("2005-2009", "2010-2014", "2015-2019", "2020-2024"),
  Coef_3P = c(1.8842, 2.6011, 3.8326, 4.7683),
  Coef_2P = c(3.7431, 4.0901, 3.1201, 2.1837)
)

# 把宽格式变成长格式
df_long <- pivot_longer(df, cols = c(Coef_3P, Coef_2P),
                        names_to = "Variable", values_to = "Coefficient")
jpeg("img/Coefficients Over Time by Variable.jpg", width = 3000, height = 1500, res = 300)
# 折线图
ggplot(df_long, aes(x = Period, y = Coefficient, color = Variable, group = Variable)) +
  geom_line(size = 1.2) +
  geom_point(size = 3) +
  labs(
    title = "Coefficients Over Time by Variable",
    x = "Period",
    y = "Coefficient",
    color = "Variable"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # 让x轴标签斜着排防止重叠
```

